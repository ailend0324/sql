# SQL数据查询 - 第二阶段

## 🎯 本阶段目标
掌握各种数据查询技巧，学会使用条件、排序、分组等高级查询功能。

## 📅 建议学习时间：2-3周

## 📚 学习内容

### 第8-9天：条件查询 (WHERE)
**理论学习**
WHERE子句用来筛选符合条件的数据，就像在图书馆里按照特定标准找书一样。

```sql
-- WHERE基本语法
SELECT 字段名 FROM 表名 WHERE 条件;
```

**实践练习**
```sql
-- 数字比较
SELECT * FROM students WHERE age > 15;
SELECT * FROM students WHERE age = 14;
SELECT * FROM students WHERE age BETWEEN 14 AND 16;

-- 文本比较
SELECT * FROM students WHERE name = '张小明';
SELECT * FROM students WHERE grade = '九年级';
SELECT * FROM students WHERE name LIKE '张%';  -- 姓张的学生

-- 多条件组合
SELECT * FROM students WHERE age > 14 AND grade = '九年级';
SELECT * FROM students WHERE age > 15 OR grade = '高一';
SELECT * FROM students WHERE age NOT IN (14, 15);
```

### 第10-11天：排序 (ORDER BY)
**理论学习**
ORDER BY用来对查询结果进行排序，就像把书按照字母顺序或者出版年份排列。

```sql
-- 排序语法
SELECT 字段名 FROM 表名 ORDER BY 字段名 [ASC|DESC];
```

**实践练习**
```sql
-- 按年龄升序排列
SELECT * FROM students ORDER BY age;
SELECT * FROM students ORDER BY age ASC;  -- ASC可以省略

-- 按年龄降序排列
SELECT * FROM students ORDER BY age DESC;

-- 多字段排序（先按年级，再按年龄）
SELECT * FROM students ORDER BY grade, age;

-- 按成绩排序
SELECT * FROM scores ORDER BY score DESC;  -- 从高分到低分
```

### 第12-13天：聚合函数
**理论学习**
聚合函数用来对一组数据进行计算，就像计算器帮你算总数、平均数等。

```sql
-- 常用聚合函数
COUNT()  -- 计数
SUM()    -- 求和
AVG()    -- 平均值
MAX()    -- 最大值
MIN()    -- 最小值
```

**实践练习**
```sql
-- 统计学生总数
SELECT COUNT(*) FROM students;

-- 计算平均年龄
SELECT AVG(age) FROM students;

-- 找最高分和最低分
SELECT MAX(score) as 最高分, MIN(score) as 最低分 FROM scores;

-- 计算总分数
SELECT SUM(score) FROM scores;

-- 统计各年级学生数量
SELECT grade, COUNT(*) as 学生数量 FROM students GROUP BY grade;
```

### 第14-15天：分组查询 (GROUP BY)
**理论学习**
GROUP BY把相同类型的数据归到一组，就像把不同科目的作业分别放到不同的文件夹里。

```sql
-- 分组语法
SELECT 字段名, 聚合函数() FROM 表名 GROUP BY 字段名;
```

**实践练习**
```sql
-- 按年级分组统计学生数量
SELECT grade as 年级, COUNT(*) as 学生数量 
FROM students 
GROUP BY grade;

-- 按科目分组计算平均分
SELECT subject_id as 科目, AVG(score) as 平均分 
FROM scores 
GROUP BY subject_id;

-- 按年级分组计算平均年龄
SELECT grade as 年级, AVG(age) as 平均年龄 
FROM students 
GROUP BY grade;

-- 使用HAVING筛选分组结果（学生数量大于1的年级）
SELECT grade, COUNT(*) as 学生数量 
FROM students 
GROUP BY grade 
HAVING COUNT(*) > 1;
```

### 第16-17天：LIKE模糊查询
**理论学习**
LIKE用于模糊匹配，就像在搜索引擎里使用关键词搜索。

```sql
-- LIKE语法
% 表示任意多个字符
_ 表示单个字符
```

**实践练习**
```sql
-- 查找姓张的学生
SELECT * FROM students WHERE name LIKE '张%';

-- 查找名字中包含"小"的学生
SELECT * FROM students WHERE name LIKE '%小%';

-- 查找三个字的姓名
SELECT * FROM students WHERE name LIKE '___';

-- 查找邮箱以school.com结尾的学生
SELECT * FROM students WHERE email LIKE '%school.com';
```

### 第18-20天：限制结果数量 (LIMIT)
**理论学习**
LIMIT用来限制查询结果的数量，就像只要前几名的成绩单。

```sql
-- LIMIT语法
SELECT 字段名 FROM 表名 LIMIT 数量;
SELECT 字段名 FROM 表名 LIMIT 跳过数量, 数量;
```

**实践练习**
```sql
-- 查询前3名学生
SELECT * FROM students LIMIT 3;

-- 查询成绩前5名
SELECT * FROM scores ORDER BY score DESC LIMIT 5;

-- 分页查询（跳过前3个，取5个）
SELECT * FROM students LIMIT 3, 5;

-- 查询年龄最小的学生
SELECT * FROM students ORDER BY age LIMIT 1;
```

### 第21天：综合练习
**复合查询练习**
```sql
-- 查询九年级学生的平均分，按平均分降序排列，只显示前3名
SELECT s.name as 学生姓名, AVG(sc.score) as 平均分
FROM students s
JOIN scores sc ON s.student_id = sc.student_id
WHERE s.grade = '九年级'
GROUP BY s.student_id, s.name
ORDER BY 平均分 DESC
LIMIT 3;

-- 查询各科目及格人数（60分以上）
SELECT sub.subject_name as 科目, COUNT(*) as 及格人数
FROM subjects sub
JOIN scores sc ON sub.subject_id = sc.subject_id
WHERE sc.score >= 60
GROUP BY sub.subject_id, sub.subject_name;
```

## ✅ 本阶段检查清单
完成后打勾：
- [ ] 掌握WHERE条件查询
- [ ] 能够使用ORDER BY排序
- [ ] 理解并使用聚合函数（COUNT、SUM、AVG等）
- [ ] 掌握GROUP BY分组查询
- [ ] 学会使用LIKE进行模糊查询
- [ ] 能够使用LIMIT限制结果数量
- [ ] 能够编写复合查询语句
- [ ] 理解HAVING与WHERE的区别

## 🎯 实战项目：个人图书管理系统查询
使用之前创建的books表，完成以下查询任务：

```sql
-- 1. 查询2010年以后出版的书籍，按价格降序排列
SELECT * FROM books WHERE publish_year > 2010 ORDER BY price DESC;

-- 2. 统计各分类书籍的数量和平均价格
SELECT category, COUNT(*) as 书籍数量, AVG(price) as 平均价格 
FROM books 
GROUP BY category;

-- 3. 查找书名中包含"三"字的书籍
SELECT * FROM books WHERE title LIKE '%三%';

-- 4. 查询价格最高的3本书
SELECT * FROM books ORDER BY price DESC LIMIT 3;

-- 5. 查询小说类且价格在20-50元之间的书籍
SELECT * FROM books 
WHERE category = '小说' AND price BETWEEN 20 AND 50;
```

## 💡 本阶段重点概念

### WHERE vs HAVING
- **WHERE**：在分组之前筛选行
- **HAVING**：在分组之后筛选组

### 执行顺序理解
```sql
SELECT     -- 5. 选择要显示的字段
FROM       -- 1. 从哪个表
WHERE      -- 2. 行级过滤
GROUP BY   -- 3. 分组
HAVING     -- 4. 组级过滤
ORDER BY   -- 6. 排序
LIMIT      -- 7. 限制数量
```

## 🎉 完成奖励
掌握了这些查询技巧后，你已经可以处理大部分的数据查询需求了！这些技能在实际工作中非常有用。

## ➡️ 下一步
完成本阶段后，可以进入 `03-表连接.md` 学习如何连接多个表进行查询。 