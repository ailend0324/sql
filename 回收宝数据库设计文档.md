# 回收宝数据库设计文档

## 📋 项目概述

回收宝是一个专注于二手电子产品回收和销售的电商平台，数据库设计涵盖了从订单管理、检测流程、仓储物流到销售渠道的完整业务链路。

## 🏗️ 数据库架构

### 核心业务模块

1. **订单管理模块** - 回收订单、售后订单、寄卖订单
2. **检测模块** - 产品检测、质量评估、检测记录
3. **仓储模块** - 入库、出库、库存管理
4. **渠道模块** - 销售渠道、合作伙伴管理
5. **财务模块** - 支付、佣金、结算
6. **物流模块** - 配送、时效管理

## 📊 字段命名规则

### 1. 前缀规则

| 前缀 | 含义 | 示例 |
|------|------|------|
| `f` | 字段标识符 | `forder_time`, `fseries_number` |
| `F` | 大写字段标识符 | `Fxy_order_id`, `Fcreate_dtime` |
| `drt_` | 数据仓库表前缀 | `drt_my33310_recycle_t_order` |
| `dws_` | 数据服务层前缀 | `dws_hs_order_detail` |
| `dwd_` | 数据明细层前缀 | `dwd_detect_back_detection_issue_and_answer_v2` |

### 2. 业务模块标识

| 模块 | 表前缀 | 说明 |
|------|--------|------|
| 回收业务 | `recycle_` | 回收相关业务 |
| 检测业务 | `detection_` | 产品检测相关 |
| 仓储业务 | `stock_` | 库存管理相关 |
| 销售业务 | `sales_` | 销售相关业务 |
| 渠道业务 | `channel_` | 渠道管理相关 |

### 3. 字段命名规范

#### 时间字段
- `forder_time` - 订单时间
- `fcreate_dtime` - 创建时间
- `fend_time` - 结束时间
- `fchange_time` - 变更时间
- `fsync_pay_out_time` - 同步支付时间

#### 标识字段
- `forder_id` - 订单ID
- `fseries_number` - 系列号（订单号）
- `fserial_number` - 序列号
- `faccount_id` - 账户ID
- `fchannel_id` - 渠道ID
- `fproduct_id` - 产品ID

#### 状态字段
- `fis_deleted` - 是否删除（0/1）
- `fdet_type` - 检测类型
- `freport_type` - 报告类型
- `fverdict` - 检测结果

## 🗂️ 核心表结构分析

### 1. 订单相关表

#### 回收订单表 (`drt_my33310_recycle_t_order`)
```sql
主要字段：
- forder_id: 订单ID
- fseries_number: 订单系列号
- forder_time: 订单时间
- frecycle_type: 回收类型（1=邮寄，2=上门，3=到店）
- fsupply_partner: 供应合作伙伴
- fpay_out_price: 支付价格（分）
- fpayment_mode: 支付模式（3=信用订单）
- ftest: 是否测试订单
```

#### 售后订单表 (`drt_my33310_recycle_t_after_sales_order_info`)
```sql
主要字段：
- fafter_sales_order_id: 售后订单ID
- fsales_series_number: 销售系列号
- fauto_create_time: 自动创建时间
- fbusiness_id: 业务ID
```

### 2. 检测相关表

#### 检测记录表 (`drt_my33310_detection_t_detect_record`)
```sql
主要字段：
- frecord_id: 记录ID
- fserial_number: 序列号
- fend_time: 检测结束时间
- freal_name: 检测工程师姓名
- fclass_name: 产品类别名称
- fproduct_name: 产品名称
- fdet_tpl: 检测模板
- fdet_type: 检测类型
- fverdict: 检测结果
- fgoods_level: 商品等级（JSON格式）
```

#### 检测问题答案表 (`dwd_detect_back_detection_issue_and_answer_v2`)
```sql
主要字段：
- fdetect_record_id: 检测记录ID
- fissue_name: 问题名称
- fanswer_name: 答案名称
- field_source: 字段来源
```

### 3. 渠道相关表

#### 渠道信息表 (`drt_my33310_recycle_t_channel`)
```sql
主要字段：
- fchannel_id: 渠道ID
- fchannel_name: 渠道名称
- fproject_name: 项目名称
```

#### 账户信息表 (`drt_my33310_recycle_t_account_info`)
```sql
主要字段：
- faccount_id: 账户ID
- faccount: 账户名称
```

### 4. 产品相关表

#### 产品信息表 (`drt_my33310_recycle_t_product`)
```sql
主要字段：
- fproduct_id: 产品ID
- fclass_id: 类别ID
- fbrand_id: 品牌ID
```

#### 产品类别表 (`drt_my33310_recycle_t_pdt_class`)
```sql
主要字段：
- fid: 类别ID
- fname: 类别名称
```

#### 产品品牌表 (`drt_my33310_recycle_t_pdt_brand`)
```sql
主要字段：
- fid: 品牌ID
- fname: 品牌名称
```

## 🔍 业务规则分析

### 1. 订单号编码规则

| 前缀 | 业务类型 | 说明 |
|------|----------|------|
| `XY`, `YJ` | 2C闲鱼 | 闲鱼平台订单 |
| `TM`, `TY` | 天猫以旧换新 | 天猫平台订单 |
| `ZF` | 支付宝小程序 | 支付宝渠道订单 |
| `CG` | 外采 | 外部采购订单 |
| `BB` | 换机侠B端帮卖 | B端帮卖订单 |
| `ZY` | 滞留单 | 滞留订单 |
| `01`, `02` | 验货宝 | 验货宝业务订单 |
| `NT` | 售后回收 | 售后回收订单 |
| `YZ` | 售后回收 | 售后回收订单 |

### 2. 仓库编码规则

| 编码 | 仓库名称 | 说明 |
|------|----------|------|
| `0112`, `0118` | 东莞仓 | 东莞仓库 |
| `0201`, `0202` | 杭州仓 | 杭州仓库 |
| 其他 | 深圳仓 | 深圳仓库 |

### 3. 检测模板类型

| 模板ID | 模板名称 | 说明 |
|--------|----------|------|
| 0 | 竞拍检测 | 竞拍业务检测 |
| 1 | 大检测 | 全面检测 |
| 2 | 竞拍检测 | 竞拍业务检测 |
| 4 | 销售检测 | 销售前检测 |
| 6 | 闲鱼寄卖plus | 闲鱼寄卖检测 |
| 7 | 竞拍检测 | 竞拍业务检测 |

### 4. 回收方式分类

| 类型ID | 回收方式 | 说明 |
|--------|----------|------|
| 1 | 邮寄 | 用户邮寄设备 |
| 2 | 上门 | 工作人员上门回收 |
| 3 | 到店 | 用户到店回收 |

### 5. 供应合作伙伴

| 合作伙伴ID | 合作伙伴类型 | 说明 |
|------------|--------------|------|
| 2 | 小站(自营) | 自营小站 |
| 3 | 小站(加盟) | 加盟小站 |
| 其他 | 回收宝 | 回收宝自营 |

## 📈 数据流转关系

### 1. 订单流转
```
用户下单 → 生成订单 → 分配渠道 → 检测评估 → 仓储入库 → 销售出库
```

### 2. 检测流程
```
设备接收 → 外观检测 → 功能检测 → 质量评估 → 生成报告 → 定价决策
```

### 3. 渠道管理
```
渠道注册 → 渠道分类 → 业务分配 → 订单分发 → 佣金结算
```

## 🔧 数据质量规则

### 1. 数据完整性
- 所有订单必须有唯一的 `fseries_number`
- 检测记录必须关联到具体的订单
- 渠道信息必须完整

### 2. 数据一致性
- 订单状态变更必须记录时间戳
- 检测结果必须与订单信息一致
- 价格信息必须以分为单位存储

### 3. 数据时效性
- 实时数据延迟不超过5分钟
- 历史数据保留2年
- 重要业务数据需要备份

## 📝 最佳实践建议

### 1. 查询优化
- 使用索引优化常用查询字段
- 避免在WHERE子句中使用函数
- 合理使用分区表提高查询效率

### 2. 数据维护
- 定期清理测试数据
- 监控数据质量指标
- 建立数据血缘关系

### 3. 安全规范
- 敏感数据需要加密存储
- 定期备份重要数据
- 建立数据访问权限控制

---

**文档版本**: v1.0  
**最后更新**: 2024年12月  
**维护人员**: 数据分析团队 