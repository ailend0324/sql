/*
ðŸ“‰ å®žæ—¶åŽ‹ä»·æƒ…å†µç›‘æŽ§
ç”¨é€”ï¼šå®žæ—¶ç›‘æŽ§è®¾å¤‡æ£€æµ‹åŽçš„ä»·æ ¼è°ƒæ•´æƒ…å†µ
å°±åƒç›‘æŽ§"æ£€æµ‹å®Œå‘çŽ°é—®é¢˜åŽï¼Œä»·æ ¼è¢«é™äº†å¤šå°‘"
*/

select
	Fsync_detect_time,                      -- æ£€æµ‹åŒæ­¥æ—¶é—´
    case when fcategory in ('å¹³æ¿','å¹³æ¿ç”µè„‘') then 'å¹³æ¿'
         when fcategory in ('ç¬”è®°æœ¬','ç¬”è®°æœ¬ç”µè„‘') then 'ç¬”è®°æœ¬'
         when fcategory in ('æ‰‹æœº','') then 'æ‰‹æœº'
         when fcategory in ('å•åé—ªå…‰ç¯',
                           'å•åè½¬æŽ¥çŽ¯',
                           'ç§»åŠ¨ç”µæº',
                           'ç§»åŠ¨ç¡¬ç›˜',
                           'äº‘å°',
                           'æ‹ç…§é…ä»¶/äº‘å°',                
                           'å¢žè·é•œ') then '3Cæ•°ç é…ä»¶'
         -- â†‘ 3Cæ•°ç é…ä»¶åˆ†ç±»ï¼šå„ç§ç”µå­äº§å“çš„é…ä»¶

         when fcategory in ('å½©è‰²æ¿€å…‰å¤šåŠŸèƒ½ä¸€ä½“æœº',
                           'å¤å°æ‰“å°å¤šåŠŸèƒ½ä¸€ä½“æœº',
                           'æ¿€å…‰æ‰“å°æœº',
                           'å¢¨ç›’',
                           'æ”¶æ¬¾æœº',
                           'æŠ•å½±æœº',
                           'ç¡’é¼“ç²‰ç›’',
                           'é’ˆå¼æ‰“å°æœº') then 'åŠžå…¬è®¾å¤‡è€—æ'
         -- â†‘ åŠžå…¬è®¾å¤‡è€—æåˆ†ç±»ï¼šæ‰“å°æœºã€æŠ•å½±ä»ªç­‰åŠžå…¬ç”¨å“

         when fcategory in ('CPU',
                           'ç”µè„‘æœåŠ¡å™¨',
                           'ç”µè„‘å›ºæ€ç¡¬ç›˜',
                           'å›ºæ€ç¡¬ç›˜',                   
                           'ç”µè„‘å†…å­˜',
                           'å†…å­˜æ¡',                 
                           'ç”µè„‘æ˜¾å¡',
                           'æ˜¾å¡',                   
                           'ç”µè„‘ç¡¬ä»¶å¥—è£…',
                           'ç”µè„‘ä¸»æ¿',
                           'é”®ç›˜',
                           'å“ç‰Œå°æœº',
                           'å“ç‰Œå°å¼æœº',
                           'æ— çº¿é¼ æ ‡',
                           'æ˜¾ç¤ºå™¨',
                           'ä¸€ä½“æœº',
                           'ç»„è£…å°æœº') then 'ç”µè„‘ç¡¬ä»¶åŠå‘¨è¾¹'
         -- â†‘ ç”µè„‘ç¡¬ä»¶åŠå‘¨è¾¹åˆ†ç±»ï¼šCPUã€æ˜¾å¡ã€å†…å­˜ç­‰ç”µè„‘é…ä»¶

         when fcategory in ('è·¯ç”±å™¨') then 'ç½‘ç»œè®¾å¤‡'
         -- â†‘ ç½‘ç»œè®¾å¤‡åˆ†ç±»

         when fcategory in ('PSæ¸¸æˆå…‰ç›˜/è½¯ä»¶',
                           'å…¶ä»–æ¸¸æˆé…ä»¶',
                           'æ¸¸æˆæœº') then 'ç”µçŽ©'
         -- â†‘ ç”µçŽ©åˆ†ç±»ï¼šæ¸¸æˆæœºã€æ¸¸æˆå…‰ç›˜ç­‰

         when fcategory in ('å•åå¥—æœº',
                           'å•åç›¸æœº',
                           'æ‹ç«‹å¾—',
                           'æ‘„åƒæœº',
                           'æ‘„å½±æœº',                   
                           'æ•°ç ç›¸æœº',
                           'å¾®å•ç›¸æœº',
                           'ç›¸æœºé•œå¤´',
                           'è¿åŠ¨ç›¸æœº',
                           'å•å/å¾®å•å¥—æœº',
                           'å•å/å¾®å•ç›¸æœº') then 'ç›¸æœº/æ‘„åƒæœº'
         -- â†‘ ç›¸æœº/æ‘„åƒæœºåˆ†ç±»ï¼šå„ç§ç›¸æœºã€æ‘„åƒæœº

         when fcategory in ('è€³æœº','MP3/MP4',
                           'é»‘èƒ¶å”±ç‰‡æœº',
                           'è“ç‰™è€³æœº',
                           'è“ç‰™éŸ³å“/éŸ³ç®±',
                           'éº¦å…‹é£Ž/è¯ç­’',
                           'å½±éŸ³æ’­æ”¾å™¨',
                           'æ™ºèƒ½éŸ³å“/éŸ³ç®±') then 'å½±éŸ³æ•°ç /ç”µå™¨'
         -- â†‘ å½±éŸ³æ•°ç /ç”µå™¨åˆ†ç±»ï¼šè€³æœºã€éŸ³å“ã€æ’­æ”¾å™¨ç­‰


         when fcategory in ('PS4æ¸¸æˆ',
                           'PS5æ¸¸æˆ',
                           'Switchæ¸¸æˆ','æ¸¸æˆå¡') then 'æ¸¸æˆå¡'
         -- â†‘ æ¸¸æˆå¡åˆ†ç±»ï¼šå„ç§æ¸¸æˆå¡ã€å…‰ç›˜



         when fcategory in ('VRçœ¼é•œå¤´ç›”','VRè™šæ‹ŸçŽ°å®ž',
                           'æŒ‰æ‘©å™¨',
                           'å¹é£Žæœº',
                           'ç£å¸å¼é”®ç›˜',
                           'ç”µå­ä¹¦',
                           'ç¿»è¯‘å™¨',
                           'é£Žæ‰‡',
                           'åŠ æ¹¿å™¨',
                           'å½•éŸ³ç¬”',
                           'ç¾Žå‘å™¨',
                           'æ‰‹å†™ç¬”',
                           'æ™ºèƒ½æ‰‹å†™ç¬”',                   
                           'æ— äººæœº',
                           'å¸å°˜å™¨',
                           'å­¦ä¹ æœº',
                           'æ™ºèƒ½åŠžå…¬æœ¬',
                           'æ™ºèƒ½é…é¥°',
                           'æ™ºèƒ½æ‘„åƒ',
                           'æ™ºèƒ½æ‰‹è¡¨',
                           'æ™ºèƒ½æ‰‹çŽ¯') then 'æ™ºèƒ½è®¾å¤‡'
         -- â†‘ æ™ºèƒ½è®¾å¤‡åˆ†ç±»ï¼šå„ç§æ™ºèƒ½è®¾å¤‡


         else "å…¶ä»–" end as fcategory
    ,case 
        a.Fship_type when 1 then "é‚®å¯„"
                    when 2 then "ä¸Šé—¨"
                    when 3 then "åˆ°åº—"
        end as å±¥çº¦æ–¹
    ,a.Fxy_channel
    ,b.ftest
    ,count(a.Fxy_order_id) as æ£€æµ‹é‡
    ,count(if(Fquote_price > Fdetect_price,1,null)) as è®®ä»·é‡
    ,sum(if(Fquote_price > Fdetect_price,a.Fquote_price/100,0)) as Fquote_price
    ,sum(if(Fquote_price > Fdetect_price,a.Fdetect_price/100,0)) as Fdetect_price
    ,sum(a.Fconfirm_fee/100) as Fconfirm_fee

from
    drt. drt_my33310_recycle_t_xy_order_data a
LEFT  JOIN  
    drt. drt_my33310_recycle_t_order  b
    ON a.Forder_id = b.Forder_id
where
    Fsync_detect_time >='2024-01-01 00:00:00' 

group by  1,2,3,4,5
