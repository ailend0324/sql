# ğŸ” SQLå…³é”®å­—æ®µå‘½åå¯¹æ¯”åˆ†æ

## ğŸ“‹ åˆ†ææ¦‚è§ˆ

å¯¹æ¯” `ç«æ‹å”®åæ˜ç»†æ•°æ®.sql`ï¼ˆåŸå§‹ç‰ˆæœ¬ï¼‰å’Œ `ç«æ‹å”®åæ˜ç»†æ•°æ®_å«é±¼å¸‚_æµ‹è¯•ç‰ˆ.sql`ï¼ˆæµ‹è¯•ç‰ˆæœ¬ï¼‰åœ¨å…³é”®å­—æ®µå‘½åæ–¹é¢çš„å¼‚åŒã€‚

---

## ğŸ¯ æ ¸å¿ƒå­—æ®µå‘½åå¯¹æ¯”

### 1. **é”€å”®æ¸ é“å­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- å›ºå®šå­—ç¬¦ä¸²ï¼Œç¡¬ç¼–ç 
"è‡ªæœ‰å¹³å°" as "é”€å”®æ¸ é“",  -- ç¬¬ä¸€ä¸ªUNIONåˆ†æ”¯
"é‡‡è´§ä¾ " as "é”€å”®æ¸ é“",    -- ç¬¬äºŒä¸ªUNIONåˆ†æ”¯
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€åˆ¤æ–­ï¼ŒåŸºäºå¹³å°ç±»å‹
case when a.forder_platform = 1 then "è‡ªæœ‰å¹³å°"
     when a.forder_platform = 5 then "é±¼å¸‚B2B"
     when a.forder_platform = 7 then "é±¼å¸‚åŒå”®"
else "å…¶ä»–å¹³å°" end as "é”€å”®æ¸ é“",
```

**å·®å¼‚åˆ†æ**ï¼š
- âœ… **åŸå§‹ç‰ˆæœ¬**ï¼šç®€å•ç›´æ¥ï¼Œä½†ç¼ºä¹çµæ´»æ€§
- âœ… **æµ‹è¯•ç‰ˆæœ¬**ï¼šåŠ¨æ€åˆ¤æ–­ï¼Œæ›´å‡†ç¡®åæ˜ å®é™…æ¸ é“
- ğŸ”„ **å‘½åä¸€è‡´æ€§**ï¼šä¸¤ä¸ªç‰ˆæœ¬éƒ½ä½¿ç”¨ `"é”€å”®æ¸ é“"` ä½œä¸ºå­—æ®µå

### 2. **å”®ååºåˆ—å·å­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- è‡ªæœ‰å¹³å°
c.fseries_number as fafter_series_number,
-- é‡‡è´§ä¾ 
c.fnew_serial_no as fafter_series_number,
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€æ˜ å°„
case when a.forder_platform = 1 then c.fseries_number
     when a.forder_platform = 5 then yushi_c.fnew_serial_no
else null end as fafter_series_number,
```

**å·®å¼‚åˆ†æ**ï¼š
- âœ… **åŸå§‹ç‰ˆæœ¬**ï¼šä¸åŒæ¸ é“ä½¿ç”¨ä¸åŒå­—æ®µï¼Œä½†é€»è¾‘åˆ†æ•£
- âœ… **æµ‹è¯•ç‰ˆæœ¬**ï¼šç»Ÿä¸€å­—æ®µåï¼Œé€šè¿‡CASEè¯­å¥å¤„ç†ä¸åŒæ¥æº
- ğŸ”„ **å‘½åä¸€è‡´æ€§**ï¼šéƒ½ä½¿ç”¨ `fafter_series_number` ä½œä¸ºç»Ÿä¸€å­—æ®µå

### 3. **å”®åç”³è¯·æ—¶é—´å­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- è‡ªæœ‰å¹³å°
c.Fauto_create_time,
-- é‡‡è´§ä¾ 
c.fapply_time,
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€æ˜ å°„
case when a.forder_platform = 1 then c.Fauto_create_time
     when a.forder_platform = 5 then yushi_c.fapply_time
else null end as Fauto_create_time,
```

**å·®å¼‚åˆ†æ**ï¼š
- âš ï¸ **å‘½åä¸ä¸€è‡´**ï¼šåŸå§‹ç‰ˆæœ¬åœ¨ä¸åŒæ¸ é“ä½¿ç”¨ä¸åŒå­—æ®µå
- âœ… **æµ‹è¯•ç‰ˆæœ¬**ï¼šç»Ÿä¸€ä½¿ç”¨ `Fauto_create_time` ä½œä¸ºå­—æ®µå
- ğŸ”„ **æ•°æ®æ¥æº**ï¼šè‡ªæœ‰å¹³å°ç”¨ `Fauto_create_time`ï¼Œé±¼å¸‚ç”¨ `fapply_time`

### 4. **ç”³è¯‰åŸå› å­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- è‡ªæœ‰å¹³å°
c.Fappeal_reason,
-- é‡‡è´§ä¾ 
c.Fjudge_reason as Fappeal_reason,
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€æ˜ å°„
case when a.forder_platform = 1 then c.Fappeal_reason
     when a.forder_platform = 5 then yushi_c.Fjudge_reason
else null end as Fappeal_reason,
```

**å·®å¼‚åˆ†æ**ï¼š
- âœ… **å‘½åä¸€è‡´æ€§**ï¼šä¸¤ä¸ªç‰ˆæœ¬éƒ½ç»Ÿä¸€ä½¿ç”¨ `Fappeal_reason`
- ğŸ”„ **æ•°æ®æ¥æº**ï¼šè‡ªæœ‰å¹³å°ç”¨ `Fappeal_reason`ï¼Œé±¼å¸‚ç”¨ `Fjudge_reason`

### 5. **åˆå®¡ç»“æœå­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- è‡ªæœ‰å¹³å°
cast(c.Ffirst_trial_result as string) as Ffirst_trial_result,
-- é‡‡è´§ä¾ 
c.Fjudge_result as Ffirst_trial_result,
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€æ˜ å°„
case when a.forder_platform = 1 then cast(c.Ffirst_trial_result as string)
     when a.forder_platform = 5 then yushi_c.Fjudge_result
else null end as Ffirst_trial_result,
```

**å·®å¼‚åˆ†æ**ï¼š
- âœ… **å‘½åä¸€è‡´æ€§**ï¼šéƒ½ä½¿ç”¨ `Ffirst_trial_result`
- ğŸ”„ **æ•°æ®ç±»å‹å¤„ç†**ï¼šè‡ªæœ‰å¹³å°éœ€è¦ `cast` è½¬æ¢ï¼Œé±¼å¸‚ç›´æ¥ä½¿ç”¨

### 6. **æ€»å®é€€æ¬¾é‡‘é¢å­—æ®µ**

#### åŸå§‹ç‰ˆæœ¬
```sql
-- è‡ªæœ‰å¹³å°
c.Ftotal_real_refund_amount/100 as "æ€»å®é€€æ¬¾é‡‘é¢",
-- é‡‡è´§ä¾ 
c.Forder_deal_price/100 as "æ€»å®é€€æ¬¾é‡‘é¢",
```

#### æµ‹è¯•ç‰ˆæœ¬
```sql
-- åŠ¨æ€æ˜ å°„
case when a.forder_platform = 1 then c.Ftotal_real_refund_amount/100
     when a.forder_platform = 5 then yushi_c.Forder_deal_price/100
else null end as "æ€»å®é€€æ¬¾é‡‘é¢",
```

**å·®å¼‚åˆ†æ**ï¼š
- âœ… **å‘½åä¸€è‡´æ€§**ï¼šéƒ½ä½¿ç”¨ `"æ€»å®é€€æ¬¾é‡‘é¢"`
- ğŸ”„ **æ•°æ®æ¥æº**ï¼šè‡ªæœ‰å¹³å°ç”¨ `Ftotal_real_refund_amount`ï¼Œé±¼å¸‚ç”¨ `Forder_deal_price`

---

## ğŸ“Š å­—æ®µå‘½åæ¨¡å¼åˆ†æ

### 1. **ç»Ÿä¸€å­—æ®µå‘½åæ¨¡å¼**

| å­—æ®µåŠŸèƒ½ | ç»Ÿä¸€å­—æ®µå | åŸå§‹ç‰ˆæœ¬å¤„ç† | æµ‹è¯•ç‰ˆæœ¬å¤„ç† |
|----------|------------|--------------|--------------|
| é”€å”®æ¸ é“ | `"é”€å”®æ¸ é“"` | ç¡¬ç¼–ç å­—ç¬¦ä¸² | åŠ¨æ€CASEåˆ¤æ–­ |
| å”®ååºåˆ—å· | `fafter_series_number` | åˆ†æ•£å¤„ç† | ç»Ÿä¸€CASEæ˜ å°„ |
| ç”³è¯‰åŸå›  | `Fappeal_reason` | åˆ†æ•£å¤„ç† | ç»Ÿä¸€CASEæ˜ å°„ |
| åˆå®¡ç»“æœ | `Ffirst_trial_result` | åˆ†æ•£å¤„ç† | ç»Ÿä¸€CASEæ˜ å°„ |
| æ€»å®é€€æ¬¾é‡‘é¢ | `"æ€»å®é€€æ¬¾é‡‘é¢"` | åˆ†æ•£å¤„ç† | ç»Ÿä¸€CASEæ˜ å°„ |

### 2. **å‘½åè§„èŒƒå¯¹æ¯”**

#### åŸå§‹ç‰ˆæœ¬å‘½åç‰¹ç‚¹
- âœ… å­—æ®µåç»Ÿä¸€ï¼Œä¾¿äºç†è§£
- âš ï¸ é€»è¾‘åˆ†æ•£ï¼Œä¸åŒæ¸ é“ä½¿ç”¨ä¸åŒå­—æ®µ
- âš ï¸ ç¼ºä¹åŠ¨æ€æ€§ï¼Œç¡¬ç¼–ç è¾ƒå¤š

#### æµ‹è¯•ç‰ˆæœ¬å‘½åç‰¹ç‚¹
- âœ… å­—æ®µåå®Œå…¨ç»Ÿä¸€
- âœ… é€»è¾‘é›†ä¸­ï¼Œä½¿ç”¨CASEè¯­å¥å¤„ç†
- âœ… åŠ¨æ€æ€§å¼ºï¼Œæ”¯æŒå¤šæ¸ é“æ‰©å±•

---

## ğŸ” å…³é”®å·®å¼‚æ€»ç»“

### âœ… å‘½åä¸€è‡´æ€§æ”¹è¿›

1. **å­—æ®µåç»Ÿä¸€**
   - ä¸¤ä¸ªç‰ˆæœ¬åœ¨å…³é”®å­—æ®µå‘½åä¸Šä¿æŒä¸€è‡´
   - æµ‹è¯•ç‰ˆæœ¬é€šè¿‡CASEè¯­å¥å®ç°ç»Ÿä¸€å­—æ®µå

2. **é€»è¾‘é›†ä¸­åŒ–**
   - åŸå§‹ç‰ˆæœ¬ï¼šé€»è¾‘åˆ†æ•£åœ¨ä¸åŒUNIONåˆ†æ”¯
   - æµ‹è¯•ç‰ˆæœ¬ï¼šé€»è¾‘é›†ä¸­åœ¨CASEè¯­å¥ä¸­

### âš ï¸ éœ€è¦æ³¨æ„çš„å·®å¼‚

1. **æ•°æ®æ¥æºå­—æ®µä¸åŒ**
   ```sql
   -- è‡ªæœ‰å¹³å°å­—æ®µ
   Fauto_create_time, Fappeal_reason, Ftotal_real_refund_amount
   
   -- é±¼å¸‚å­—æ®µ  
   fapply_time, Fjudge_reason, Forder_deal_price
   ```

2. **æ•°æ®ç±»å‹å¤„ç†**
   ```sql
   -- åŸå§‹ç‰ˆæœ¬
   cast(c.Ffirst_trial_result as string)
   
   -- æµ‹è¯•ç‰ˆæœ¬
   cast(c.Ffirst_trial_result as string)  -- è‡ªæœ‰å¹³å°
   yushi_c.Fjudge_result                  -- é±¼å¸‚
   ```

---

## ğŸ¯ å‘½åä¼˜åŒ–å»ºè®®

### 1. **å­—æ®µå‘½åæ ‡å‡†åŒ–**
```sql
-- å»ºè®®ç»Ÿä¸€ä½¿ç”¨ä»¥ä¸‹å‘½åè§„èŒƒ
fafter_series_number -- å”®ååºåˆ—å·
fapply_time         -- ç”³è¯·æ—¶é—´
Fappeal_reason      -- ç”³è¯‰åŸå› 
Ffirst_trial_result -- åˆå®¡ç»“æœ
"æ€»å®é€€æ¬¾é‡‘é¢"       -- é€€æ¬¾é‡‘é¢
```

### 2. **æ•°æ®æºå­—æ®µæ˜ å°„è¡¨**
```sql
| åŠŸèƒ½ | è‡ªæœ‰å¹³å°å­—æ®µ | é±¼å¸‚å­—æ®µ | ç»Ÿä¸€å­—æ®µå |
|------|-------------|----------|------------|
| ç”³è¯·æ—¶é—´ | Fauto_create_time | fapply_time | fapply_time |
| ç”³è¯‰åŸå›  | Fappeal_reason | Fjudge_reason | Fappeal_reason |
| é€€æ¬¾é‡‘é¢ | Ftotal_real_refund_amount | Forder_deal_price | "æ€»å®é€€æ¬¾é‡‘é¢" |
```

### 3. **CASEè¯­å¥ä¼˜åŒ–**
```sql
-- å»ºè®®çš„ä¼˜åŒ–æ¨¡å¼
case 
    when a.forder_platform = 1 then c.è‡ªæœ‰å¹³å°å­—æ®µ
    when a.forder_platform = 5 then yushi_c.é±¼å¸‚å­—æ®µ
    else null 
end as ç»Ÿä¸€å­—æ®µå
```

---

## ğŸ“ æ€»ç»“

### âœ… æµ‹è¯•ç‰ˆæœ¬çš„æ”¹è¿›

1. **å­—æ®µå‘½åæ›´ç»Ÿä¸€** - é€šè¿‡CASEè¯­å¥å®ç°ç»Ÿä¸€å­—æ®µå
2. **é€»è¾‘æ›´é›†ä¸­** - é¿å…åœ¨UNIONåˆ†æ”¯ä¸­é‡å¤é€»è¾‘
3. **æ‰©å±•æ€§æ›´å¥½** - æ–°å¢æ¸ é“åªéœ€æ·»åŠ CASEåˆ†æ”¯
4. **ç»´æŠ¤æ€§æ›´å¼º** - å­—æ®µæ˜ å°„é€»è¾‘é›†ä¸­ç®¡ç†

### ğŸ”„ ä¿æŒçš„ä¸€è‡´æ€§

1. **å…³é”®å­—æ®µåä¿æŒä¸€è‡´** - ä¸¤ä¸ªç‰ˆæœ¬ä½¿ç”¨ç›¸åŒçš„å­—æ®µå
2. **æ•°æ®ç±»å‹å¤„ç†ä¸€è‡´** - éƒ½è¿›è¡Œäº†é€‚å½“çš„ç±»å‹è½¬æ¢
3. **ä¸šåŠ¡é€»è¾‘ä¸€è‡´** - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ²¡æœ‰å˜åŒ–

æµ‹è¯•ç‰ˆæœ¬åœ¨å­—æ®µå‘½åæ–¹é¢è¿›è¡Œäº†é‡è¦ä¼˜åŒ–ï¼Œå®ç°äº†æ›´å¥½çš„ç»Ÿä¸€æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¿æŒäº†ä¸åŸå§‹ç‰ˆæœ¬çš„å…¼å®¹æ€§ã€‚ 