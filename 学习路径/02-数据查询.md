# 🔍 SQL数据查询技巧 - 第二阶段学习指南

## 🎯 学习目标
掌握SQL查询的核心技巧，能够编写复杂的数据分析语句。

**学习时间**：2-3周  
**适合人群**：已掌握基础SQL语法，想深入学习查询技巧

---

## 📚 学习内容概览

### 第1周：条件查询和排序
- WHERE条件查询（AND、OR、IN、LIKE）
- ORDER BY排序技巧
- LIMIT限制结果数量

### 第2周：聚合函数和分组
- COUNT、SUM、AVG、MAX、MIN
- GROUP BY分组统计
- HAVING分组后筛选

### 第3周：表连接和子查询
- INNER JOIN、LEFT JOIN、RIGHT JOIN
- 子查询（WHERE子查询、FROM子查询）
- 多表关联查询

---

## 🔍 第1周：条件查询和排序

### 1.1 WHERE条件查询进阶

#### 基础条件查询
```sql
-- 查找年龄大于15岁的学生
SELECT * FROM students WHERE age > 15;

-- 查找特定年级的学生
SELECT * FROM students WHERE grade = '九年级';

-- 查找多个条件（AND）
SELECT * FROM students WHERE age > 14 AND grade = '九年级';
```

#### 复杂条件查询
```sql
-- 使用OR条件
SELECT * FROM students WHERE grade = '九年级' OR grade = '高一';

-- 使用IN条件（等同于多个OR）
SELECT * FROM students WHERE grade IN ('九年级', '高一');

-- 使用LIKE模糊查询
SELECT * FROM students WHERE name LIKE '小%';  -- 以"小"开头
SELECT * FROM students WHERE name LIKE '%明';  -- 以"明"结尾
SELECT * FROM students WHERE name LIKE '%小%'; -- 包含"小"
```

#### 空值处理
```sql
-- 查找年龄不为空的学生
SELECT * FROM students WHERE age IS NOT NULL;

-- 查找年龄为空的学生
SELECT * FROM students WHERE age IS NULL;
```

### 1.2 ORDER BY排序技巧

#### 基础排序
```sql
-- 按年龄升序排列
SELECT * FROM students ORDER BY age ASC;

-- 按年龄降序排列
SELECT * FROM students ORDER BY age DESC;

-- 默认升序（ASC可以省略）
SELECT * FROM students ORDER BY age;
```

#### 多字段排序
```sql
-- 先按年级排序，再按年龄排序
SELECT * FROM students ORDER BY grade, age;

-- 不同字段不同排序方向
SELECT * FROM students ORDER BY grade ASC, age DESC;
```

### 1.3 LIMIT限制结果

```sql
-- 只显示前5条记录
SELECT * FROM students LIMIT 5;

-- 跳过前3条，显示接下来的5条
SELECT * FROM students LIMIT 3, 5;

-- 按年龄排序后取前3名
SELECT * FROM students ORDER BY age DESC LIMIT 3;
```

---

## 📊 第2周：聚合函数和分组

### 2.1 聚合函数详解

#### 基础聚合函数
```sql
-- 统计学生总数
SELECT COUNT(*) FROM students;

-- 计算平均年龄
SELECT AVG(age) FROM students;

-- 找出最大年龄
SELECT MAX(age) FROM students;

-- 找出最小年龄
SELECT MIN(age) FROM students;

-- 计算年龄总和
SELECT SUM(age) FROM students;
```

#### 聚合函数与条件结合
```sql
-- 统计九年级学生数量
SELECT COUNT(*) FROM students WHERE grade = '九年级';

-- 计算九年级学生平均年龄
SELECT AVG(age) FROM students WHERE grade = '九年级';
```

### 2.2 GROUP BY分组统计

#### 基础分组
```sql
-- 按年级统计学生数量
SELECT grade, COUNT(*) as student_count 
FROM students 
GROUP BY grade;

-- 按年级统计平均年龄
SELECT grade, AVG(age) as avg_age 
FROM students 
GROUP BY grade;
```

#### 多字段分组
```sql
-- 按年级和性别分组统计
SELECT grade, gender, COUNT(*) as count 
FROM students 
GROUP BY grade, gender;
```

### 2.3 HAVING分组后筛选

```sql
-- 找出学生数量超过2人的年级
SELECT grade, COUNT(*) as student_count 
FROM students 
GROUP BY grade 
HAVING COUNT(*) > 2;

-- 找出平均年龄超过15岁的年级
SELECT grade, AVG(age) as avg_age 
FROM students 
GROUP BY grade 
HAVING AVG(age) > 15;
```

---

## 🔗 第3周：表连接和子查询

### 3.1 表连接基础

#### INNER JOIN（内连接）
```sql
-- 连接学生表和成绩表
SELECT s.name, s.grade, sc.subject, sc.score
FROM students s
INNER JOIN scores sc ON s.id = sc.student_id;
```

#### LEFT JOIN（左连接）
```sql
-- 显示所有学生，包括没有成绩的学生
SELECT s.name, s.grade, sc.subject, sc.score
FROM students s
LEFT JOIN scores sc ON s.id = sc.student_id;
```

#### RIGHT JOIN（右连接）
```sql
-- 显示所有成绩记录，包括没有对应学生的成绩
SELECT s.name, s.grade, sc.subject, sc.score
FROM students s
RIGHT JOIN scores sc ON s.id = sc.student_id;
```

### 3.2 子查询技巧

#### WHERE子查询
```sql
-- 找出年龄大于平均年龄的学生
SELECT * FROM students 
WHERE age > (SELECT AVG(age) FROM students);

-- 找出有数学成绩的学生
SELECT * FROM students 
WHERE id IN (SELECT student_id FROM scores WHERE subject = '数学');
```

#### FROM子查询
```sql
-- 使用子查询作为临时表
SELECT grade, COUNT(*) as student_count
FROM (SELECT * FROM students WHERE age > 14) as older_students
GROUP BY grade;
```

---

## 💡 实用技巧

### 1. 查询优化建议
- 使用索引字段进行WHERE条件筛选
- 避免使用SELECT *，只查询需要的字段
- 合理使用LIMIT限制结果数量

### 2. 常见错误避免
- 忘记GROUP BY时使用聚合函数
- WHERE和HAVING使用错误
- 表连接时字段名冲突

### 3. 调试技巧
```sql
-- 分步调试复杂查询
-- 1. 先测试基础查询
SELECT * FROM students WHERE age > 15;

-- 2. 再添加聚合函数
SELECT grade, COUNT(*) FROM students WHERE age > 15 GROUP BY grade;

-- 3. 最后添加HAVING条件
SELECT grade, COUNT(*) FROM students WHERE age > 15 
GROUP BY grade HAVING COUNT(*) > 1;
```

---

## 📝 练习建议

### 每日练习（30分钟）
1. **复习前一天的内容**
2. **完成练习题**
3. **尝试修改示例代码**
4. **记录学习笔记**

### 周末项目
- 设计一个简单的学生管理系统
- 编写完整的CRUD操作
- 进行数据分析练习

---

## 🎯 学习检查清单

### 第1周目标
- [ ] 掌握WHERE条件查询的各种用法
- [ ] 学会使用ORDER BY排序
- [ ] 理解LIMIT的作用
- [ ] 能够编写复杂的条件查询

### 第2周目标
- [ ] 掌握所有聚合函数
- [ ] 学会使用GROUP BY分组
- [ ] 理解HAVING的用法
- [ ] 能够进行分组统计

### 第3周目标
- [ ] 掌握各种表连接方式
- [ ] 学会编写子查询
- [ ] 理解多表关联查询
- [ ] 能够解决复杂查询问题

---

## 🚀 下一步学习

完成本阶段学习后，你将能够：
- 编写复杂的数据查询语句
- 进行多表关联分析
- 解决实际的数据分析问题

**下一步**：进入第三阶段，学习实战应用和业务数据分析！

---

**记住**：查询技巧需要大量练习，每天保持30分钟的练习时间，你一定能掌握SQL查询的精髓！ 